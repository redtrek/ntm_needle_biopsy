\doxysection{/home/redtrek/\+NTM/ntm\+\_\+needle\+\_\+biopsy/code/biopsy\+\_\+needle/src/include/ntm\+\_\+helpers.h File Reference}
\hypertarget{ntm__helpers_8h}{}\label{ntm__helpers_8h}\index{/home/redtrek/NTM/ntm\_needle\_biopsy/code/biopsy\_needle/src/include/ntm\_helpers.h@{/home/redtrek/NTM/ntm\_needle\_biopsy/code/biopsy\_needle/src/include/ntm\_helpers.h}}


This file holds the prototypes for smart needle\textquotesingle{}s helper functions.  


{\ttfamily \#include "{}pins.\+h"{}}\newline
{\ttfamily \#include "{}config.\+h"{}}\newline
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$string$>$}\newline
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include "{}../../libs/\+SSD1306/ssd1306.\+h"{}}\newline
{\ttfamily \#include "{}pico/stdlib.\+h"{}}\newline
{\ttfamily \#include "{}hw\+\_\+config.\+h"{}}\newline
{\ttfamily \#include "{}f\+\_\+util.\+h"{}}\newline
{\ttfamily \#include "{}ff.\+h"{}}\newline
{\ttfamily \#include $<$bsp/board.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$tusb.\+h$>$}\newline
{\ttfamily \#include "{}tusb\+\_\+config.\+h"{}}\newline
Include dependency graph for ntm\+\_\+helpers.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{ntm__helpers_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{ntm__helpers_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{ntm__helpers_8h_a8c6d7458362f0a1d72f048e5c28dafc9}{board\+\_\+gpio\+\_\+init}} ()
\begin{DoxyCompactList}\small\item\em Initiates all GPIO pins as well as communication protocols. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{ntm__helpers_8h_a1a668d0f88bcacc451fca6bf25511b62}{set\+Motor}} (bool direction, uint16\+\_\+t power)
\begin{DoxyCompactList}\small\item\em Turns on motor with configureable speed and direction values. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{ntm__helpers_8h_a42ebef78c974c5dd10ee53b6bea5ac07}{display\+Data}} (ssd1306\+\_\+t \texorpdfstring{$\ast$}{*}screen, int y\+\_\+pos, float data, std\+::string info)
\begin{DoxyCompactList}\small\item\em Helper function used to abstract how sensor data is shown on the OLED screen. \end{DoxyCompactList}\item 
float \mbox{\hyperlink{ntm__helpers_8h_a8b0e682ac7928c7d2592cb80a81a2874}{get\+Revolutions}} (int count)
\begin{DoxyCompactList}\small\item\em Takes detected motor signals and converts them to the real-\/world number of revolutions of the motor shaft. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file holds the prototypes for smart needle\textquotesingle{}s helper functions. 

\begin{DoxyAuthor}{Author}
Thomas Chang 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2025-\/05-\/06
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2025 
\end{DoxyCopyright}


Definition in file \mbox{\hyperlink{ntm__helpers_8h_source}{ntm\+\_\+helpers.\+h}}.



\doxysubsection{Function Documentation}
\Hypertarget{ntm__helpers_8h_a8c6d7458362f0a1d72f048e5c28dafc9}\label{ntm__helpers_8h_a8c6d7458362f0a1d72f048e5c28dafc9} 
\index{ntm\_helpers.h@{ntm\_helpers.h}!board\_gpio\_init@{board\_gpio\_init}}
\index{board\_gpio\_init@{board\_gpio\_init}!ntm\_helpers.h@{ntm\_helpers.h}}
\doxysubsubsection{\texorpdfstring{board\_gpio\_init()}{board\_gpio\_init()}}
{\footnotesize\ttfamily void board\+\_\+gpio\+\_\+init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Initiates all GPIO pins as well as communication protocols. 



Definition at line \mbox{\hyperlink{ntm__helpers_8cpp_source_l00026}{26}} of file \mbox{\hyperlink{ntm__helpers_8cpp_source}{ntm\+\_\+helpers.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00026\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00027\ \ \ \ \ \textcolor{comment}{//\ Potentiometer\ Input}}
\DoxyCodeLine{00028\ \ \ \ \ adc\_init();}
\DoxyCodeLine{00029\ \ \ \ \ adc\_gpio\_init(speed\_input);}
\DoxyCodeLine{00030\ \ \ \ \ adc\_gpio\_init(bat\_lvl);}
\DoxyCodeLine{00031\ }
\DoxyCodeLine{00032\ \ \ \ \ \textcolor{comment}{//\ Pushbutton\ State\ Input}}
\DoxyCodeLine{00033\ \ \ \ \ gpio\_init(state\_input);}
\DoxyCodeLine{00034\ \ \ \ \ gpio\_set\_dir(state\_input,\ GPIO\_IN);}
\DoxyCodeLine{00035\ \ \ \ \ gpio\_pull\_down(state\_input);}
\DoxyCodeLine{00036\ }
\DoxyCodeLine{00037\ \ \ \ \ \textcolor{comment}{//\ Pushbutton\ MSC\ Input}}
\DoxyCodeLine{00038\ \ \ \ \ gpio\_init(msc\_input);}
\DoxyCodeLine{00039\ \ \ \ \ gpio\_set\_dir(msc\_input,\ GPIO\_IN);}
\DoxyCodeLine{00040\ \ \ \ \ gpio\_pull\_down(msc\_input);}
\DoxyCodeLine{00041\ \ \ \ \ }
\DoxyCodeLine{00042\ \ \ \ \ \textcolor{comment}{//\ Motor\ Control}}
\DoxyCodeLine{00043\ \ \ \ \ gpio\_set\_function(MOTOR\_PWM,\ GPIO\_FUNC\_PWM);}
\DoxyCodeLine{00044\ \ \ \ \ pwm\_set\_clkdiv(\mbox{\hyperlink{ntm__helpers_8cpp_ac7597a58fd0a9415759b81dffee974e6}{slice}},\ 48.83f);}
\DoxyCodeLine{00045\ \ \ \ \ pwm\_set\_wrap(\mbox{\hyperlink{ntm__helpers_8cpp_ac7597a58fd0a9415759b81dffee974e6}{slice}},\ 255);}
\DoxyCodeLine{00046\ \ \ \ \ pwm\_set\_chan\_level(\mbox{\hyperlink{ntm__helpers_8cpp_ac7597a58fd0a9415759b81dffee974e6}{slice}},\ \mbox{\hyperlink{ntm__helpers_8cpp_a23777d4d3d69af11916d27e48261cfb1}{channel}},\ 0);}
\DoxyCodeLine{00047\ \ \ \ \ pwm\_set\_enabled(\mbox{\hyperlink{ntm__helpers_8cpp_ac7597a58fd0a9415759b81dffee974e6}{slice}},\ \textcolor{keyword}{true});}
\DoxyCodeLine{00048\ \ \ \ \ gpio\_init(MOTOR\_DIR);}
\DoxyCodeLine{00049\ \ \ \ \ gpio\_set\_dir(MOTOR\_DIR,\ GPIO\_OUT);}
\DoxyCodeLine{00050\ }
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{comment}{//\ Motor\ Feedback\ -\/\ Output\ Signals}}
\DoxyCodeLine{00052\ \ \ \ \ gpio\_init(motorA\_out);}
\DoxyCodeLine{00053\ \ \ \ \ gpio\_set\_dir(motorA\_out,\ GPIO\_IN);}
\DoxyCodeLine{00054\ \ \ \ \ gpio\_pull\_up(motorA\_out);}
\DoxyCodeLine{00055\ \ \ \ \ gpio\_init(motorB\_out);}
\DoxyCodeLine{00056\ \ \ \ \ gpio\_set\_dir(motorB\_out,\ GPIO\_IN);}
\DoxyCodeLine{00057\ \ \ \ \ gpio\_pull\_up(motorB\_out);}
\DoxyCodeLine{00058\ \ \ \ \ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ I2C\ Initialization}}
\DoxyCodeLine{00060\ \ \ \ \ i2c\_init(MY\_I2C,\ 400000);}
\DoxyCodeLine{00061\ \ \ \ \ gpio\_set\_function(I2C\_SDA,\ GPIO\_FUNC\_I2C);}
\DoxyCodeLine{00062\ \ \ \ \ gpio\_set\_function(I2C\_SCL,\ GPIO\_FUNC\_I2C);}
\DoxyCodeLine{00063\ \ \ \ \ gpio\_pull\_up(I2C\_SDA);}
\DoxyCodeLine{00064\ \ \ \ \ gpio\_pull\_up(I2C\_SCL);}
\DoxyCodeLine{00065\ \}}

\end{DoxyCode}
\Hypertarget{ntm__helpers_8h_a42ebef78c974c5dd10ee53b6bea5ac07}\label{ntm__helpers_8h_a42ebef78c974c5dd10ee53b6bea5ac07} 
\index{ntm\_helpers.h@{ntm\_helpers.h}!displayData@{displayData}}
\index{displayData@{displayData}!ntm\_helpers.h@{ntm\_helpers.h}}
\doxysubsubsection{\texorpdfstring{displayData()}{displayData()}}
{\footnotesize\ttfamily void display\+Data (\begin{DoxyParamCaption}\item[{ssd1306\+\_\+t \texorpdfstring{$\ast$}{*}}]{screen,  }\item[{int}]{y\+\_\+pos,  }\item[{float}]{data,  }\item[{std\+::string}]{info }\end{DoxyParamCaption})}



Helper function used to abstract how sensor data is shown on the OLED screen. 


\begin{DoxyParams}{Parameters}
{\em screen} & OLED object representing the actual screen in firmware. \\
\hline
{\em y\+\_\+pos} & The y position in pixels (bottom left) of where the text is written. \\
\hline
{\em data} & The actual sensor information. \\
\hline
{\em info} & Any string messages detailing what the sensor information is measuring. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{ntm__helpers_8cpp_source_l00072}{72}} of file \mbox{\hyperlink{ntm__helpers_8cpp_source}{ntm\+\_\+helpers.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00073\ \ \ \ \ std::string\ temp\ =\ info\ +\ std::to\_string(data);}
\DoxyCodeLine{00074\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}*\ data\_formatted\ =\ temp.c\_str();}
\DoxyCodeLine{00075\ \ \ \ \ ssd1306\_draw\_string(screen,\ 0,\ y\_pos,\ 1,\ data\_formatted);}
\DoxyCodeLine{00076\ \}}

\end{DoxyCode}
\Hypertarget{ntm__helpers_8h_a8b0e682ac7928c7d2592cb80a81a2874}\label{ntm__helpers_8h_a8b0e682ac7928c7d2592cb80a81a2874} 
\index{ntm\_helpers.h@{ntm\_helpers.h}!getRevolutions@{getRevolutions}}
\index{getRevolutions@{getRevolutions}!ntm\_helpers.h@{ntm\_helpers.h}}
\doxysubsubsection{\texorpdfstring{getRevolutions()}{getRevolutions()}}
{\footnotesize\ttfamily float get\+Revolutions (\begin{DoxyParamCaption}\item[{int}]{count }\end{DoxyParamCaption})}



Takes detected motor signals and converts them to the real-\/world number of revolutions of the motor shaft. 

The conversion is as follows\+: number\+\_\+of\+\_\+counts \texorpdfstring{$\ast$}{*} (1 small revolution / 12 counts) \texorpdfstring{$\ast$}{*} (1 big revolution / 34.\+014 small revolutions). 34.\+014 is the gear ratio whilst the (small revolutions / counts) is from the motor documentation. 
\begin{DoxyParams}{Parameters}
{\em count} & Number of signal edges recieved from motor (see quadrature encoder information in motor documentation). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
float 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{ntm__helpers_8cpp_source_l00078}{78}} of file \mbox{\hyperlink{ntm__helpers_8cpp_source}{ntm\+\_\+helpers.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordtype}{float}\ re\ =\ count/12.0/34.014f;}
\DoxyCodeLine{00080\ \ \ \ \ \textcolor{keywordflow}{return}\ re;}
\DoxyCodeLine{00081\ \}}

\end{DoxyCode}
\Hypertarget{ntm__helpers_8h_a1a668d0f88bcacc451fca6bf25511b62}\label{ntm__helpers_8h_a1a668d0f88bcacc451fca6bf25511b62} 
\index{ntm\_helpers.h@{ntm\_helpers.h}!setMotor@{setMotor}}
\index{setMotor@{setMotor}!ntm\_helpers.h@{ntm\_helpers.h}}
\doxysubsubsection{\texorpdfstring{setMotor()}{setMotor()}}
{\footnotesize\ttfamily void set\+Motor (\begin{DoxyParamCaption}\item[{bool}]{direction,  }\item[{uint16\+\_\+t}]{power }\end{DoxyParamCaption})}



Turns on motor with configureable speed and direction values. 


\begin{DoxyParams}{Parameters}
{\em direction} & Integer value where 1 means forward and 0 means backward. \\
\hline
{\em power} & Integer value representing power of the motor ranging from 0-\/255 where 255 is the maximum. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{ntm__helpers_8cpp_source_l00067}{67}} of file \mbox{\hyperlink{ntm__helpers_8cpp_source}{ntm\+\_\+helpers.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00068\ \ \ \ \ gpio\_put(MOTOR\_DIR,\ direction);}
\DoxyCodeLine{00069\ \ \ \ \ pwm\_set\_chan\_level(\mbox{\hyperlink{ntm__helpers_8cpp_ac7597a58fd0a9415759b81dffee974e6}{slice}},\ \mbox{\hyperlink{ntm__helpers_8cpp_a23777d4d3d69af11916d27e48261cfb1}{channel}},\ power);}
\DoxyCodeLine{00070\ \}}

\end{DoxyCode}
